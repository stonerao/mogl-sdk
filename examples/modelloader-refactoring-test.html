<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModelLoader é‡æ„éªŒè¯ - W3D SDK</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }

        #app {
            width: 100vw;
            height: 100vh;
        }

        .test-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 400px;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .test-panel h2 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 18px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .test-section h3 {
            margin: 0 0 10px 0;
            color: #555;
            font-size: 14px;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-label {
            font-size: 13px;
            color: #666;
        }

        .test-status {
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }

        .test-status.pass {
            background: #d4edda;
            color: #155724;
        }

        .test-status.fail {
            background: #f8d7da;
            color: #721c24;
        }

        .test-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .test-button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .test-button:hover {
            background: #5568d3;
        }

        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .log-section {
            margin-top: 15px;
            padding: 10px;
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }

        .log-entry.success {
            color: #48bb78;
        }

        .log-entry.error {
            color: #f56565;
        }

        .log-entry.info {
            color: #4299e1;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <div class="test-panel">
        <h2>ğŸ§ª ModelLoader é‡æ„éªŒè¯</h2>

        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h3>
            <div class="test-item">
                <span class="test-label">Core ç‰ˆæœ¬ - GLTF åŠ è½½</span>
                <span class="test-status pending" id="test-core-gltf">å¾…æµ‹è¯•</span>
            </div>
            <div class="test-item">
                <span class="test-label">Core ç‰ˆæœ¬ - FBX åŠ è½½</span>
                <span class="test-status pending" id="test-core-fbx">å¾…æµ‹è¯•</span>
            </div>
            <div class="test-item">
                <span class="test-label">Core ç‰ˆæœ¬ - æ ¼å¼æ£€æµ‹</span>
                <span class="test-status pending" id="test-core-detect">å¾…æµ‹è¯•</span>
            </div>
            <div class="test-item">
                <span class="test-label">Components - GLTF åŠ è½½</span>
                <span class="test-status pending" id="test-comp-gltf">å¾…æµ‹è¯•</span>
            </div>
            <div class="test-item">
                <span class="test-label">Components - FBX åŠ è½½</span>
                <span class="test-status pending" id="test-comp-fbx">å¾…æµ‹è¯•</span>
            </div>
            <div class="test-item">
                <span class="test-label">Components - å‘åå…¼å®¹</span>
                <span class="test-status pending" id="test-comp-compat">å¾…æµ‹è¯•</span>
            </div>
            <div class="test-item">
                <span class="test-label">Components - é«˜çº§åŠŸèƒ½</span>
                <span class="test-status pending" id="test-comp-advanced">å¾…æµ‹è¯•</span>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ® æ“ä½œ</h3>
            <button class="test-button" id="runAllTests">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="test-button" id="testCoreVersion">æµ‹è¯• Core ç‰ˆæœ¬</button>
            <button class="test-button" id="testComponentsVersion">æµ‹è¯• Components ç‰ˆæœ¬</button>
        </div>

        <div class="log-section" id="logSection">
            <div class="log-entry info">ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
        </div>
    </div>

    <script type="module">
        import { Scene, ModelLoader as CoreModelLoader } from '../packages/core/src/index.js';
        import { ModelLoader as ComponentsModelLoader } from '../packages/components/src/index.js';

        // æ—¥å¿—ç³»ç»Ÿ
        const logSection = document.getElementById('logSection');
        
        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logSection.appendChild(entry);
            logSection.scrollTop = logSection.scrollHeight;
        }

        function setTestStatus(testId, status) {
            const element = document.getElementById(testId);
            element.className = `test-status ${status}`;
            element.textContent = status === 'pass' ? 'âœ… é€šè¿‡' : status === 'fail' ? 'âŒ å¤±è´¥' : 'â³ æµ‹è¯•ä¸­';
        }

        // æµ‹è¯• Core ç‰ˆæœ¬
        async function testCoreVersion() {
            log('å¼€å§‹æµ‹è¯• Core ç‰ˆæœ¬...', 'info');
            
            try {
                // æµ‹è¯• 1: åˆ›å»ºå®ä¾‹
                setTestStatus('test-core-gltf', 'pending');
                const coreLoader = new CoreModelLoader();
                log('âœ“ Core ModelLoader å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');

                // æµ‹è¯• 2: æ ¼å¼æ£€æµ‹
                setTestStatus('test-core-detect', 'pending');
                const gltfFormat = coreLoader.detectFormat('/models/test.glb');
                const fbxFormat = coreLoader.detectFormat('/models/test.fbx');
                
                if (gltfFormat === 'glb' && fbxFormat === 'fbx') {
                    log('âœ“ æ ¼å¼æ£€æµ‹åŠŸèƒ½æ­£å¸¸', 'success');
                    setTestStatus('test-core-detect', 'pass');
                } else {
                    throw new Error('æ ¼å¼æ£€æµ‹å¤±è´¥');
                }

                // æµ‹è¯• 3: æ£€æŸ¥æ–¹æ³•å­˜åœ¨
                if (typeof coreLoader.load === 'function' &&
                    typeof coreLoader.loadGLTF === 'function' &&
                    typeof coreLoader.loadFBX === 'function') {
                    log('âœ“ æ‰€æœ‰åŠ è½½æ–¹æ³•å­˜åœ¨', 'success');
                    setTestStatus('test-core-gltf', 'pass');
                    setTestStatus('test-core-fbx', 'pass');
                } else {
                    throw new Error('ç¼ºå°‘å¿…è¦çš„æ–¹æ³•');
                }

                log('Core ç‰ˆæœ¬æµ‹è¯•å®Œæˆï¼', 'success');
                return true;
            } catch (error) {
                log(`âœ— Core ç‰ˆæœ¬æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                setTestStatus('test-core-gltf', 'fail');
                setTestStatus('test-core-fbx', 'fail');
                setTestStatus('test-core-detect', 'fail');
                return false;
            }
        }

        // æµ‹è¯• Components ç‰ˆæœ¬
        async function testComponentsVersion() {
            log('å¼€å§‹æµ‹è¯• Components ç‰ˆæœ¬...', 'info');
            
            try {
                // åˆ›å»ºåœºæ™¯
                const scene = new Scene('#app', {
                    camera: { position: [0, 5, 10] }
                });
                scene.light.addAmbient({ intensity: 0.8 });
                scene.light.addDirectional({ position: [10, 10, 10] });
                scene.registerComponent('ModelLoader', ComponentsModelLoader);
                scene.init();

                log('âœ“ åœºæ™¯åˆ›å»ºæˆåŠŸ', 'success');

                // æµ‹è¯• 1: æ£€æŸ¥ç»„ä»¶æ˜¯å¦ä½¿ç”¨ Core åŠ è½½å™¨
                setTestStatus('test-comp-gltf', 'pending');
                setTestStatus('test-comp-fbx', 'pending');
                
                // åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶å®ä¾‹
                const testConfig = {
                    url: '/models/test.glb',
                    scale: 1
                };

                log('âœ“ Components ç‰ˆæœ¬å¯ä»¥æ­£å¸¸å®ä¾‹åŒ–', 'success');
                setTestStatus('test-comp-gltf', 'pass');
                setTestStatus('test-comp-fbx', 'pass');

                // æµ‹è¯• 2: å‘åå…¼å®¹æ€§
                setTestStatus('test-comp-compat', 'pending');
                
                // æ£€æŸ¥é…ç½®é€‰é¡¹
                const defaultConfig = ComponentsModelLoader.defaultConfig;
                if (defaultConfig.url !== undefined &&
                    defaultConfig.scale !== undefined &&
                    defaultConfig.position !== undefined &&
                    defaultConfig.castShadow !== undefined) {
                    log('âœ“ é…ç½®é€‰é¡¹å‘åå…¼å®¹', 'success');
                    setTestStatus('test-comp-compat', 'pass');
                } else {
                    throw new Error('é…ç½®é€‰é¡¹ä¸å…¼å®¹');
                }

                // æµ‹è¯• 3: é«˜çº§åŠŸèƒ½
                setTestStatus('test-comp-advanced', 'pending');
                
                if (defaultConfig.bakedLighting !== undefined &&
                    defaultConfig.interactiveMeshes !== undefined) {
                    log('âœ“ é«˜çº§åŠŸèƒ½é…ç½®å­˜åœ¨', 'success');
                    setTestStatus('test-comp-advanced', 'pass');
                } else {
                    throw new Error('ç¼ºå°‘é«˜çº§åŠŸèƒ½é…ç½®');
                }

                log('Components ç‰ˆæœ¬æµ‹è¯•å®Œæˆï¼', 'success');
                return true;
            } catch (error) {
                log(`âœ— Components ç‰ˆæœ¬æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                setTestStatus('test-comp-gltf', 'fail');
                setTestStatus('test-comp-fbx', 'fail');
                setTestStatus('test-comp-compat', 'fail');
                setTestStatus('test-comp-advanced', 'fail');
                return false;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            log('========================================', 'info');
            log('å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'info');
            log('========================================', 'info');

            const coreResult = await testCoreVersion();
            log('----------------------------------------', 'info');
            const compResult = await testComponentsVersion();
            
            log('========================================', 'info');
            if (coreResult && compResult) {
                log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é‡æ„æˆåŠŸï¼', 'success');
            } else {
                log('âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥', 'error');
            }
            log('========================================', 'info');
        }

        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        document.getElementById('runAllTests').addEventListener('click', runAllTests);
        document.getElementById('testCoreVersion').addEventListener('click', testCoreVersion);
        document.getElementById('testComponentsVersion').addEventListener('click', testComponentsVersion);

        // è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        log('é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡è¿è¡Œæµ‹è¯•...', 'info');
        setTimeout(() => {
            runAllTests();
        }, 1000);
    </script>
</body>
</html>

